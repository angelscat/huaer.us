<!DOCTYPE html>
<html>
	<head>
        <title>花儿 - 组件</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="Content-Language" content="zh-CN" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="angelscat">
        <meta name="keywords" content="">
        <meta name="description" content="">
        <meta name="robots" content="index,follow">
        <link href="huaer_dede/templets/huaer/assets/css/core.css" rel="stylesheet" media="screen">
        <script type="text/javascript" src="assets/js/libs/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="assets/js/core.js"></script>
        <script type="text/javascript">
            var catalogdata = [{id:1,name:"小学生作文",type:1,children:[{id:4,name:"小学一年级",type:1,children:[]},{id:5,name:"小学二年级",type:1,children:[]},{id:6,name:"小学三年级",type:1,children:[]},{id:7,name:"小学四年级",type:1,children:[]},{id:8,name:"小学五年级",type:1,children:[]},{id:9,name:"小学六年级",type:1,children:[]}]}]
            // var data = [{
            //     id:1,
            //     name:'小学生作文',
            //     grades:[{
            //         id:11,
            //         name:'小学一年级',
            //         types:[{
            //             id:111,
            //             name:'写景'
            //         },{
            //             id:112,
            //             name:'叙事'
            //         },{
            //             id:113,
            //             name:'写人'
            //         }]
            //     },{
            //         id:12,
            //         name:'小学二年级',
            //         types:[{
            //             id:121,
            //             name:'写景'
            //         },{
            //             id:122,
            //             name:'状物'
            //         },{
            //             id:123,
            //             name:'叙事'
            //         }]
            //     },{
            //         id:13,
            //         name:'小学三年级',
            //         types:[{
            //             id:131,
            //             name:'叙事'
            //         },{
            //             id:132,
            //             name:'抒情'
            //         },{
            //             id:133,
            //             name:'状物'
            //         }]
            //     }]
            // },{
            //     id:2,
            //     name:'初中生作文',
            //     grades:[{
            //         id:21,
            //         name:'初中一年级',
            //         types:[{
            //             id:211,
            //             name:'写景'
            //         },{
            //             id:212,
            //             name:'状物'
            //         },{
            //             id:213,
            //             name:'写人'
            //         }]
            //     },{
            //         id:22,
            //         name:'初中二年级',
            //         types:[{
            //             id:221,
            //             name:'叙事'
            //         },{
            //             id:222,
            //             name:'抒情'
            //         },{
            //             id:223,
            //             name:'写人'
            //         }]
            //     },{
            //         id:23,
            //         name:'初中三年级',
            //         types:[{
            //             id:231,
            //             name:'状物'
            //         },{
            //             id:232,
            //             name:'叙事'
            //         },{
            //             id:233,
            //             name:'写人'
            //         }]
            //     }]
            // },{
            //     id:3,
            //     name:'高中生作文',
            //     grades:[{
            //         id:31,
            //         name:'高中一年级',
            //         types:[{
            //             id:311,
            //             name:'写景'
            //         },{
            //             id:312,
            //             name:'状物'
            //         },{
            //             id:313,
            //             name:'叙事'
            //         }]
            //     },{
            //         id:32,
            //         name:'高中二年级',
            //         types:[{
            //             id:321,
            //             name:'写景'
            //         },{
            //             id:322,
            //             name:'抒情'
            //         },{
            //             id:323,
            //             name:'写人'
            //         }]
            //     },{
            //         id:33,
            //         name:'高中三年级',
            //         types:[{
            //             id:331,
            //             name:'叙事'
            //         },{
            //             id:332,
            //             name:'抒情'
            //         },{
            //             id:333,
            //             name:'状物'
            //         }]
            //     }]
            // }]

            // var data = {};
            // data['1'] = {belong:0,name:'小学生作文'};
            // data['2'] = {belong:0,name:'初中生作文'};
            // data['3'] = {belong:0,name:'高中生作文'};
            // data['11'] = {belong:1,name:'小学一年级'};
            // data['12'] = {belong:1,name:'小学二年级'};
            // data['13'] = {belong:1,name:'小学三年级'};
            // data['14'] = {belong:1,name:'小学四年级'};
            // data['15'] = {belong:1,name:'小学五年级'};
            // data['16'] = {belong:1,name:'小学六年级'};
            // data['21'] = {belong:2,name:'初中一年级'};
            // data['22'] = {belong:2,name:'初中二年级'};
            // data['23'] = {belong:2,name:'初中三年级'};
            // data['31'] = {belong:3,name:'高中一年级'};
            // data['32'] = {belong:3,name:'高中二年级'};
            // data['33'] = {belong:3,name:'高中三年级'};
            // data['111'] = {belong:11,name:'写景'};
            // data['112'] = {belong:11,name:'抒情'};
            // data['113'] = {belong:11,name:'写人'};
            // data['121'] = {belong:12,name:'叙事'};
            // data['121'] = {belong:12,name:'写景'};
            // data['121'] = {belong:12,name:'抒情'};
            // data['131'] = {belong:13,name:'状物'};
            // data['131'] = {belong:13,name:'写景'};
            // data['131'] = {belong:13,name:'想象'};
            // data['141'] = {belong:14,name:'状物'};
            // data['141'] = {belong:14,name:'写景'};
            // data['141'] = {belong:14,name:'状物'};
            // data['151'] = {belong:15,name:'抒情'};
            // data['151'] = {belong:15,name:'写景'};
            // data['161'] = {belong:16,name:'抒情'};
            // data['161'] = {belong:16,name:'叙事'};
            // data['211'] = {belong:21,name:'状物'};
            // data['211'] = {belong:21,name:'写景'};
            // data['221'] = {belong:22,name:'抒情'};
            // data['221'] = {belong:22,name:'写景'};
            // data['231'] = {belong:23,name:'叙事'};
            // data['231'] = {belong:23,name:'写景'};
            // data['311'] = {belong:31,name:'叙事'};
            // data['311'] = {belong:31,name:'抒情'};
            // data['321'] = {belong:32,name:'写景'};
            // data['321'] = {belong:32,name:'叙事'};
            // data['331'] = {belong:33,name:'抒情'};
            // data['331'] = {belong:33,name:'写景'};

            var CatalogSelector = function(options){
                $.extend(this,options);
                this.init();
            }
            CatalogSelector.prototype = {
                template:'<div class="catalog-dialog"> \
                            <dl class="catalogs"> \
                                <dt>请选择最终分类(如：写景、叙事等)</dt> \
                                <dd><ul class="school" id="catalogSchool"></ul></dd> \
                                <dd><ul class="grade" id="catalogGrade"></ul></dd> \
                                <dd><ul class="type" id="catalogType"></ul></dd> \
                            </dl> \
                        </div>',
                init:function(){
                    this.catalogData = catalogdata;
                    this.currentSchool = this.catalogData[0];
                    this.currentGrade = this.currentSchool.children[0];
                    this.currentType = this.currentGrade.children[0];
                    this._initDom();
                    this.updateSchool();
                    this._initEvent();
                },
                _initDom:function(){
                    this.el = $(this.template);
                    this.catalog = this.el.find('.catalogs');
                    this.catalogSchool = this.el.find('#catalogSchool');
                    this.catalogGrade = this.el.find('#catalogGrade');
                    this.catalogType = this.el.find('#catalogType');
                    if($.browser.msie){
                        this.el.append('<iframe width="100%" height="100%" frameBorder="0" src="javascript:false" style="position:absolute;top:0;left:0;z-index:1;"></iframe>');
                    }
                    this.el.css({
                        left:-9999,
                        top:-9999
                    }).appendTo($('body'));

                    this.show();
                },
                updateSchool:function(){
                    var schools = this.catalogData,
                        lst = ''
                    for(var i = 0, len = schools.length; i < len; i++){
                        lst += '<li><a data-index="'+ i +'" data-id="'+ schools[i].id +'" href="javascript:;"'+ (i === 0 ? 'class="cur"' : '') +'>'+ schools[i].name +'</a></li>';
                    }
                    this.catalogSchool.html(lst);
                    this.currentSchool = schools[0]
                    this.updateGrade();
                },
                updateGrade:function(){
                    var grades = this.currentSchool.children,
                        lst = '';
                    for(var i = 0, len = grades.length; i < len; i++){
                        lst += '<li><a data-index="'+ i +'" data-id="'+ grades[i].id +'" href="javascript:;"'+ (i === 0 ? 'class="cur"' : '') +'>'+ grades[i].name +'</a></li>';
                    }
                    this.catalogGrade.html(lst);
                    this.currentGrade = grades[0]
                    this.updateType();
                },
                updateType:function(){
                    var types = this.currentGrade.children,
                        lst = '';
                    for(var i = 0, len = types.length; i < len; i++){
                        lst += '<li><a data-index="'+ i +'" data-id="'+ types[i].id +'" href="javascript:;">'+ types[i].name +'</a></li>';
                    }
                    this.catalogType.html(lst);
                },
                _initEvent:function(){
                    var _this = this;
                    this.catalogSchool.on('click','a',function(){
                        var target = $(this),
                            index = target.attr('data-index') * 1,
                            id = target.attr('data-id') * 1;
                        if(target.hasClass('cur')) return;
                        _this.catalogSchool.find('a.cur').removeClass('cur');
                        target.addClass('cur');
                        _this.currentSchool = _this.catalogData[index];
                        _this.updateGrade();
                    });
                    this.catalogGrade.on('click','a',function(){
                        var target = $(this),
                            index = target.attr('data-index') * 1,
                            id = target.attr('data-id') * 1;
                        if(target.hasClass('cur')) return;
                        _this.catalogGrade.find('a.cur').removeClass('cur');
                        target.addClass('cur');
                        _this.currentGrade = _this.currentSchool.children[index];
                        _this.updateType();
                    });
                    this.catalogType.on('click','a',function(){
                        var target = $(this),
                            index = target.attr('data-index') * 1,
                            id = target.attr('data-id') * 1;
                        _this.catalogType.find('a.cur').removeClass('cur');
                        target.addClass('cur');
                        _this.currentType = _this.currentGrade.children[index];

                        _this.hide();

                        _this.callback && _this.callback(_this.currentSchool, _this.currentGrade, _this.currentType);
                    });

                    this.el.on('click',function(e){
                        e.stopPropagation();
                    })

                    this._hide = function(){
                        _this.hide();
                    }
                    $(document).on('click',this._hide);
                },
                show:function(left,top){
                    var x, y, winWidth, winHeight,
                        isStrictMode = (document.compatMode != "BackCompat");
                    winWidth = isStrictMode ? document.documentElement.clientWidth : document.body.clientWidth;
                    winHeight = isStrictMode ? document.documentElement.clientHeight : document.body.clientHeight;
                    x = left || this.left || Math.max(parseInt((winWidth - this.el.width())/2),0) + $(document).scrollLeft();
                    y = top || this.top || Math.max(parseInt((winHeight - this.el.height())/2),0) + $(document).scrollTop();

                    this.el.css({
                        left:x,
                        top:y
                    })
                },
                hide:function(){
                    this.el.css({
                        left:-9999,
                        top:-9999
                    })
                },
                remove:function(){
                    $(document).off('click',this._hide);
                    this.el.remove();
                }
            }

            jQuery(function(){
                var selector = $('.catalog-selector'),
                    offset = selector.offset(),
                    width = selector.width() + 2;

                var catalogSelector;
                selector.on('click',function(e){
                    if(catalogSelector){
                         catalogSelector.show(offset.left + width - catalogSelector.el.width(), offset.top);
                    }else{
                        catalogSelector = new CatalogSelector({
                            left:-9999,
                            top:-9999,
                            callback:function(school,grade,type){
                                school.name + '>' + grade.name + '>' + type.name
                                selector.find('.value').text(grade.name + '>' + type.name);
                                selector.find('input').val(type.id);
                            }
                        })
                        catalogSelector.show(offset.left + width - catalogSelector.el.width(), offset.top)
                    }
                    e.stopPropagation();
                })
                
            });
        </script>
	</head>
	<body>
		<div class="content" style="width:960px; margin:10px auto;">
            <div class="selector catalog-selector pull-right" style="width:238px;">
                <input type="hidden" name="typeid" />
                <a href="javascript:;" hidefocus="true" class="trigger">
                    <span class="value">请选择作文分类</span>
                    <span class="handle"></span>
                </a>
            </div>

            <div class="selector catalog-selector pull-right" style="display:none;">
                <a href="javascript:;" hidefocus="true" class="trigger">
                    <span class="value">测试测试1测试测试1测试测试1测试测试1</span>
                    <span class="handle"></span>
                </a>
                <dl class="catalogs" style="display:none;">
                    <dt>请选择最终分类(如：写景、叙事等)</dt>
                    <dd>
                        <ul class="school">
                            <li><a href="#" class="cur">小学生作文</a></li>
                            <li><a href="#">初中生作文</a></li>
                            <li><a href="#">高中生作文</a></li>
                        </ul>
                    </dd>
                    <dd>
                        <ul class="grade">
                            <li><a href="#" class="cur">小学一年级</a></li>
                            <li><a href="#">小学二年级</a></li>
                            <li><a href="#">小学三年级</a></li>
                            <li><a href="#">小学四年级</a></li>
                            <li><a href="#">小学五年级</a></li>
                            <li><a href="#">小学六年级</a></li>
                        </ul>
                    </dd>
                    <dd>
                        <ul class="type">
                            <li><a href="#" class="cur">写人</a></li>
                            <li><a href="#">叙事</a></li>
                            <li><a href="#">写景</a></li>
                            <li><a href="#">抒情</a></li>
                            <li><a href="#">想象</a></li>
                            <li><a href="#">读后感</a></li>
                            <li><a href="#">日记</a></li>
                            <li><a href="#">叙事</a></li>
                            <li><a href="#">写景</a></li>
                            <li><a href="#">抒情</a></li>
                            <li><a href="#">想象</a></li>
                            <li><a href="#">读后感</a></li>
                            <li><a href="#">日记</a></li>
                            <li><a href="#">想象</a></li>
                            <li><a href="#">读后感</a></li>
                            <li><a href="#">日记</a></li>
                            <li><a href="#">叙事</a></li>
                            <li><a href="#">写景</a></li>
                            <li><a href="#">抒情</a></li>
                            <li><a href="#">想象</a></li>
                            <li><a href="#">读后感</a></li>
                            <li><a href="#">日记</a></li>
                        </ul>
                    </dd>
                </dl>
            </div>
		</div>
	</body>
</html>